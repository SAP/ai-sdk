"use strict";(self.webpackChunksap_ai_sdk_documentation=self.webpackChunksap_ai_sdk_documentation||[]).push([[1950],{2339:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>h,frontMatter:()=>d,metadata:()=>s,toc:()=>c});const s=JSON.parse('{"id":"orchestration/embedding","title":"Embedding","description":"How to use the SAP Cloud SDK for AI to generate embeddings using the Orchestration service on SAP AI Core.","source":"@site/docs-js/orchestration/embedding.mdx","sourceDirName":"orchestration","slug":"/orchestration/embedding","permalink":"/ai-sdk/docs/js/orchestration/embedding","draft":false,"unlisted":false,"editUrl":"https://github.com/SAP/ai-sdk/edit/main/docs-js/orchestration/embedding.mdx","tags":[],"version":"current","frontMatter":{"id":"embedding","title":"Embedding","hide_title":false,"hide_table_of_contents":false,"description":"How to use the SAP Cloud SDK for AI to generate embeddings using the Orchestration service on SAP AI Core.","keywords":["sap","cloud","sdk","ai","orchestration","embedding"]},"sidebar":"docsJsSidebar","previous":{"title":"Chat Completion","permalink":"/ai-sdk/docs/js/orchestration/chat-completion"},"next":{"title":"Foundation Models","permalink":"/ai-sdk/docs/js/foundation-models/"}}');var t=i(4848),o=i(8453);const d={id:"embedding",title:"Embedding",hide_title:!1,hide_table_of_contents:!1,description:"How to use the SAP Cloud SDK for AI to generate embeddings using the Orchestration service on SAP AI Core.",keywords:["sap","cloud","sdk","ai","orchestration","embedding"]},r=void 0,a={},c=[{value:"Installation",id:"installation",level:2},{value:"Quick Start",id:"quick-start",level:2},{value:"Response Object and Numeric Embeddings",id:"response-object-and-numeric-embeddings",level:2},{value:"Batch Embedding",id:"batch-embedding",level:2},{value:"Harmonized API",id:"harmonized-api",level:2},{value:"Data Masking",id:"data-masking",level:2},{value:"Custom Deployment Configuration",id:"custom-deployment-configuration",level:2},{value:"Custom Request Configuration",id:"custom-request-configuration",level:2},{value:"Custom Destination",id:"custom-destination",level:2},{value:"Error Handling",id:"error-handling",level:2},{value:"Notes",id:"notes",level:2}];function l(e){const n={a:"a",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,o.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"@sap-ai-sdk/orchestration"})," package provides a client for the orchestration service of SAP AI Core.\nUse the orchestration embedding client to generate vector embeddings from text inputs using a harmonized API across embedding models.\nYou can optionally enable orchestration modules such as ",(0,t.jsx)(n.a,{href:"#data-masking",children:"masking"})," for Personally Identifiable Information (PII) protection."]}),"\n",(0,t.jsxs)(n.p,{children:["Find more details about orchestration workflow ",(0,t.jsx)(n.a,{href:"https://help.sap.com/docs/sap-ai-core/sap-ai-core-service-guide/orchestration-workflow-v2",children:"here"}),".\nFor more details about embeddings endpoint, refer ",(0,t.jsx)(n.a,{href:"https://help.sap.com/docs/sap-ai-core/sap-ai-core-service-guide/embeddings",children:"here"}),".\nFind more details about Chat Completion ",(0,t.jsx)(n.a,{href:"/ai-sdk/docs/js/orchestration/chat-completion",children:"here"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"installation",children:"Installation"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"npm install @sap-ai-sdk/orchestration\n"})}),"\n",(0,t.jsx)(n.h2,{id:"quick-start",children:"Quick Start"}),"\n",(0,t.jsxs)(n.p,{children:["Initialize the ",(0,t.jsx)(n.code,{children:"OrchestrationEmbeddingClient"})," with the embedding model configuration.\nThen call ",(0,t.jsx)(n.code,{children:"embed()"})," with your input."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import { OrchestrationEmbeddingClient } from '@sap-ai-sdk/orchestration';\n\nconst embeddingClient = new OrchestrationEmbeddingClient({\n  embeddings: {\n    model: {\n      name: 'text-embedding-3-large'\n      // version: 'latest',         // optional\n      // params: { dimensions: 4 }  // optional, model-specific parameters\n    }\n  }\n});\n\nconst response = await embeddingClient.embed({\n  input: 'AI is fascinating'\n  // type: 'text' // optional, Represents the task for which the embeddings need to be generated. Defaults to 'text'.\n});\n\n// Access the embedding vectors and usage\nconst data = response.getEmbeddings();\nconst usage = response.getTokenUsage();\n"})}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"input"})," field can be a single string or an array of strings for batch embedding."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"type"})," field optimizes embeddings for a given task (",(0,t.jsx)(n.code,{children:"text"}),", ",(0,t.jsx)(n.code,{children:"document"}),", or ",(0,t.jsx)(n.code,{children:"query"}),")."]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Use the following convenience methods for handling embedding responses:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"getEmbeddings()"})," method returns an array of embedding items: ",(0,t.jsx)(n.code,{children:"{ object: 'embedding', index: number, embedding: number[] | string }[]"}),"."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"getTokenUsage()"})," method provides token usage details for the embeddings request."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"getIntermediateResults()"})," method returns orchestration module intermediate results (if present), such as masking diagnostics."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"response-object-and-numeric-embeddings",children:"Response Object and Numeric Embeddings"}),"\n",(0,t.jsxs)(n.p,{children:["Embedding items returned by ",(0,t.jsx)(n.code,{children:"getEmbeddings()"})," have the shape:\n",(0,t.jsx)(n.code,{children:"{ object: 'embedding', index: number, embedding: number[] | string }"}),"."]}),"\n",(0,t.jsx)(n.p,{children:"Access vector embeddings as follows:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const embeddings = response.getEmbeddings().map(item => item.embedding);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["If the provider returns numeric vectors, each element in ",(0,t.jsx)(n.code,{children:"embeddings"})," is a ",(0,t.jsx)(n.code,{children:"number[]"}),".\nMost providers will return numeric vectors unless configured differently."]}),"\n",(0,t.jsx)(n.h2,{id:"batch-embedding",children:"Batch Embedding"}),"\n",(0,t.jsxs)(n.p,{children:["Pass an array of strings to embed multiple inputs at once.\nThe array returned by ",(0,t.jsx)(n.code,{children:"getEmbeddings()"})," includes an ",(0,t.jsx)(n.code,{children:"index"})," field.\nUse the index to correlate the embeddings to the input array order."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const response = await embeddingClient.embed({\n  input: ['First text to embed', 'Second text to embed']\n});\n\nfor (const item of response.getEmbeddings()) {\n  console.log(item.index, item.embedding);\n}\n"})}),"\n",(0,t.jsx)(n.h2,{id:"harmonized-api",children:"Harmonized API"}),"\n",(0,t.jsxs)(n.p,{children:["The harmonized API lets you use different foundation models without the need to change the client code.\nSet the model in ",(0,t.jsx)(n.code,{children:"embeddings.model.name"}),". You can easily switch providers like in the example below:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const embeddingClient = new OrchestrationEmbeddingClient({\n  embeddings: {\n    model: {\n      // Example OpenAI model:\n      name: 'text-embedding-3-large'\n      // Example alternative:\n      // name: 'amazon--titan-embed-text'\n      // name: 'nvidia--llama-3.2-nv-embedqa-1b'\n    }\n  }\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Check the ",(0,t.jsx)(n.a,{href:"https://me.sap.com/notes/3437766",children:"SAP Notes"})," for all available embedding models on SAP Generative AI Hub."]}),"\n",(0,t.jsx)(n.h2,{id:"data-masking",children:"Data Masking"}),"\n",(0,t.jsx)(n.p,{children:"Use the orchestration embedding client with the masking module to mask sensitive information before it is sent to the embedding model."}),"\n",(0,t.jsx)(n.p,{children:"The following example demonstrates how to use data masking with the orchestration embedding client."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"import {\n  OrchestrationEmbeddingClient,\n  buildDpiMaskingProvider\n} from '@sap-ai-sdk/orchestration';\n\nconst client = new OrchestrationEmbeddingClient({\n  embeddings: {\n    model: { name: 'text-embedding-3-large' }\n  },\n  masking: {\n    masking_providers: [\n      buildDpiMaskingProvider({\n        method: 'pseudonymization',\n        entities: ['profile-email', 'profile-person']\n      })\n    ]\n  }\n});\n\nconst response = await client.embed({\n  input:\n    'Hello, my name is Alice Johnson and my email is alice.johnson@company.com.',\n  type: 'text'\n});\n\nconst embeddings = response.getEmbeddings().map(item => item.embedding);\nconst maskingDiagnostics = response.getIntermediateResults();\nconsole.log(embeddings);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"custom-deployment-configuration",children:"Custom Deployment Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["By default, there should be an orchestration deployment in the ",(0,t.jsx)(n.code,{children:"default"})," ",(0,t.jsx)(n.a,{href:"https://help.sap.com/docs/sap-ai-core/sap-ai-core-service-guide/resource-groups",children:"Resource Group"}),"."]}),"\n",(0,t.jsxs)(n.p,{children:["If the orchestration service has been deployed in a different resource group, specify the ",(0,t.jsx)(n.code,{children:"resourceGroup"})," when creating the client."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"// Using a custom resource group\nconst embeddingClient = new OrchestrationEmbeddingClient(\n  {\n    embeddings: { model: { name: 'text-embedding-3-large' } }\n  },\n  { resourceGroup: 'YOUR_RESOURCE_GROUP' }\n);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Additionally, it is possible to manually specify a deployment ID using the ",(0,t.jsx)(n.code,{children:"deploymentId"})," property instead of letting the SDK resolve it.\nMake sure to set the correct resource group in which the deployment was created."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const embeddingClient = new OrchestrationEmbeddingClient(orchestrationConfig, {\n  deploymentId: 'YOUR_DEPLOYMENT_ID'\n});\n"})}),"\n",(0,t.jsxs)(n.p,{children:["Refer to ",(0,t.jsx)(n.a,{href:"https://help.sap.com/docs/sap-ai-core/sap-ai-core-service-guide/create-deployment-for-orchestration",children:"Create a Deployment for Orchestration"})," for more details on how to create and manage deployments for orchestration."]}),"\n",(0,t.jsx)(n.h2,{id:"custom-request-configuration",children:"Custom Request Configuration"}),"\n",(0,t.jsxs)(n.p,{children:["Add custom headers or query parameters by passing a ",(0,t.jsx)(n.code,{children:"CustomRequestConfig"})," as the second parameter to ",(0,t.jsx)(n.code,{children:"embed()"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const response = await embeddingClient.embed(\n  {\n    input: 'Vectorize this text'\n  },\n  {\n    headers: {\n      'x-custom-header': 'custom-value'\n      // Add more headers here\n    },\n    params: {\n      // Add more parameters here\n    }\n    // Add more request configuration here\n  }\n);\n"})}),"\n",(0,t.jsx)(n.h2,{id:"custom-destination",children:"Custom Destination"}),"\n",(0,t.jsxs)(n.p,{children:["When initializing the client, it is possible to provide a custom destination.\nFor example, when targeting a destination with the name ",(0,t.jsx)(n.code,{children:"YOUR_DESTINATION_NAME"}),", the following code can be used:"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"const client = new OrchestrationEmbeddingClient(\n  orchestrationEmbeddingConfig,\n  deploymentConfig,\n  { destinationName: 'YOUR_DESTINATION_NAME' }\n);\n"})}),"\n",(0,t.jsxs)(n.p,{children:["By default, the fetched destination is cached.\nTo disable caching, set the ",(0,t.jsx)(n.code,{children:"useCache"})," parameter to ",(0,t.jsx)(n.code,{children:"false"})," together with the ",(0,t.jsx)(n.code,{children:"destinationName"})," parameter."]}),"\n",(0,t.jsxs)(n.p,{children:["For more information about configuring a destination, refer to the ",(0,t.jsx)(n.a,{href:"/ai-sdk/docs/js/connecting-to-ai-core#using-a-destination",children:"Using a Destination"})," section."]}),"\n",(0,t.jsx)(n.h2,{id:"error-handling",children:"Error Handling"}),"\n",(0,t.jsxs)(n.p,{children:["Embedding requests may fail due to invalid configuration, unavailable deployments, quota limits, or provider errors.\nWrap calls in ",(0,t.jsx)(n.code,{children:"try/catch"})," and consult the cause for more details."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-ts",children:"try {\n  await embeddingClient.embed({ input: '...' });\n} catch (error: any) {\n  console.error(error.message);\n  console.error(error.cause?.response?.data); // orchestration/provider error details if available\n}\n"})}),"\n",(0,t.jsxs)(n.p,{children:["See ",(0,t.jsx)(n.a,{href:"/ai-sdk/docs/js/error-handling",children:"Error Handling"})," for general guidance."]}),"\n",(0,t.jsx)(n.h2,{id:"notes",children:"Notes"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Streaming is not applicable to embedding endpoints."}),"\n",(0,t.jsxs)(n.li,{children:["When using ",(0,t.jsx)(n.code,{children:"params"})," in the model configuration, supported fields depend on the chosen model/provider."]}),"\n",(0,t.jsxs)(n.li,{children:["The ",(0,t.jsx)(n.code,{children:"type"})," field in the embedding request depends on model or provider support. For some models it is mandatory (for example, ",(0,t.jsx)(n.code,{children:"nvidia--llama-3.2-nv-embedqa-1b"}),"), and for others it is optional. See the ",(0,t.jsx)(n.a,{href:"https://help.sap.com/docs/sap-ai-core/sap-ai-core-service-guide/embeddings",children:"orchestration documentation"})," for details."]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>d,x:()=>r});var s=i(6540);const t={},o=s.createContext(t);function d(e){const n=s.useContext(o);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:d(e.components),s.createElement(o.Provider,{value:n},e.children)}}}]);