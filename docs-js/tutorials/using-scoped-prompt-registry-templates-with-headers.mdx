---
id: using-scoped-prompt-registry-templates-with-headers
title: Using Scoped Prompt Registry Templates with Headers
sidebar_label: Scoped Prompt Registry Templates with Headers
description: Learn how to create orchestration deployments and use scoped prompt registry templates with custom headers for resource group isolation.
keywords:
  - tutorial
  - orchestration
  - prompt registry
  - scoped templates
  - headers
  - resource groups
---

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import useBaseUrl from '@docusaurus/useBaseUrl';

## Introduction

This tutorial demonstrates the use of scoped prompt registry templates with custom headers in the SAP AI Core orchestration service.
Scoped templates enable the isolation of prompt templates within specific resource groups, thereby improving security and organizational control.
The tutorial guides you through the process of creating an orchestration deployment and configuring prompt templates with resource-group scoping through the use of custom headers.

## Step 1: Create Configuration (If one does not exist already)

If no configuration exists, then one must be created first.

```ts
const configurationPostData: AiConfigurationBaseData = {
  name: 'config-example',
  executableId: 'orchestration',
  scenarioId: 'orchestration'
};

const result: AiConfigurationCreationResponse =
  await ConfigurationApi.configurationCreate(configurationPostData, {
    'AI-Resource-Group': 'my-resource-group',
    'AI-Resource-Group-Scope': 'true'
  }).execute();
```

## Step 2: Create Orchestration Deployment (If one does not exist already)

If no orchestration deployment exists for the target resource group, then one must be created.

```ts
const deploymentResponse = await createDeployment(
  'my-orchestration-config-id',
  'my-resource-group'
);
```

## Step 3: Create Prompt Template with Specific Resource Group Scope

```ts
const promptTemplate = await PromptTemplatesApi.createUpdatePromptTemplate(
  {
    name: 'my-scoped-template',
    scenario: 'my-scenario',
    version: '0.0.1',
    spec: {
      template: [
        {
          content: 'Hello, world!',
          role: 'user'
        }
      ]
    }
  },
  {
    'AI-Resource-Group-Scope': 'true',
    'AI-Resource-Group': 'my-resource-group'
  }
).execute();
```

## Step 4: Refer to a Prompt Template with the created Resource Group Scope

Create a prompt template in the Prompt Registry with resource group scoping.
Use custom headers to specify the scope.

```ts
import { OrchestrationClient } from '@sap-ai-sdk/orchestration';

const orchestrationClient = new OrchestrationClient(
  {
    promptTemplating: {
      model: {
        name: 'gpt-4o'
      },
      prompt: {
        template_ref: {
          name: 'my-scoped-template',
          scenario: 'my-scenario',
          version: '1.0.0',
          scope: 'resource_group'
        }
      }
    }
  },
  {
    resourceGroup: 'my-resource-group'
  }
);

// Make the request with custom headers for scoping
const response = await orchestrationClient.chatCompletion({
  messages: [{ role: 'user', content: 'Hello, how can I help you?' }]
});
```

This configuration ensures that the prompt template is scoped to the specified resource group and uses the appropriate headers for access control.
