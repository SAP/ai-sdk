---
id: embedding
title: Embedding
hide_title: false
hide_table_of_contents: false
description: How to use the SAP Cloud SDK for AI to perform embedding tasks using Azure OpenAI models through SAP AI Core.
keywords:
  - sap
  - cloud
  - sdk
  - ai
  - embedding
  - openai
---

Initialize the `AzureOpenAiEmbeddingClient` by following the instructions in the [Client Initialization](../../foundation-models#client-initialization) section.

Currently, the client sends request with Azure OpenAI API version `2024-10-21`.
We are continuously updating the client to match the latest API specification.
You can overwrite the API version by setting the `api-version` parameter in the `CustomRequestConfig` object.
Refer to the [Custom Request Configuration](../../foundation-models#custom-request-configuration) section for more details.

## Making Requests

```ts
const response = await client.run({
  input: 'AI is fascinating'
});
const embedding = response.getEmbedding();
```

## Resilience

The `@sap-cloud-sdk/resilience` package uses the SAP Cloud SDK for JavaScript HTTP client, which provides built-in resilience features to handle transient failures and improve reliability.

### Retry

The HTTP client automatically retries failed requests on transient errors (e.g., network issues, temporary server errors). You can customize retry behavior using the resilience library.

For example, to set a custom retry count:

<!-- vale off -->

```ts
const request = {
  input: 'What is the capital of Germany?'
};

const response = await client.run(request, {
  middleware: [
    retry({ maxRetries: 3, backoffType: 'exponential', initialDelay: 1000 })
  ]
});
```

<!-- vale on -->

### Timeout

Configure timeout for requests to prevent hanging connections.
The default timeout is 10 seconds.

<!-- vale off -->

```ts
const request = {
  input: 'Create a 10-15 sentence long story involving a train ride.'
};

const response = await client.run(request, {
  timeout: 30000 // 30 seconds
});
```

### Combining Resilience Patterns

You can combine multiple resilience patterns for comprehensive protection.

<!-- vale off -->

```ts
const request = {
  input: 'Generate a creative story about space exploration.'
};

const response = await client.run(request, {
  middleware: [
    retry({ maxRetries: 3, backoffType: 'exponential', initialDelay: 1000 }),
    circuitBreaker({ failureThreshold: 5, recoveryTimeout: 60000 }),
    timeout(30000)
  ]
});
```

<!-- vale on -->

For advanced resilience patterns, refer to the [SAP Cloud SDK documentation on resilience](https://sap.github.io/cloud-sdk/docs/js/guides/resilience).

### Request Cancellation

Cancel HTTP requests using the `AbortSignal` API to stop in-flight requests when they are no longer needed.
Pass an `AbortSignal` through the `signal` property of the request configuration parameter when calling the `run()` or `stream()` method.

```ts
const controller = new AbortController();

const request = {
  input: 'What is the capital of Germany?'
};

const response = await client.run(request, {
  signal: controller.signal
});

// Cancel the request after one second
setTimeout(() => {
  controller.abort();
}, 1000);

try {
  await response;
} catch (error) {
  console.error('Request was cancelled:', error.message);
}
```

Request cancellation is useful when end-users navigate away from a page, close a dialog, or explicitly cancel an operation.

:::note
HTTP request cancellation may not cancel the request on the AI service.
The cancellation stops the HTTP connection from the client side, but the service may continue processing the request.
Metering information may not be available for cancelled requests.
:::
